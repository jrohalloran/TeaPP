<!-- Top-level container -->
<div class="app-wrapper">
<div class="title-wrapper">
    <h1>Pedigree Visualisation</h1>
  <mat-accordion class="help-bar">
  <mat-expansion-panel class="custom-help-panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Help
      </mat-panel-title>
    </mat-expansion-panel-header>
        <p>This visualisation tool has been developed to all easy exploration of the pedigree data uploaded to TeaPP. A default graph is displayed in the top container ready for interaction and seelction of individual nodes.
      Specific graph layout options can be selected in the right-handside panel, which will render a new visualisation when "update" is selected.
    </p>
    <p>Selection of individual plants will display its pedigree family (closest relatives) in the bottom containe, highlighting the respective individuals in the original graph above.</p>
  </mat-expansion-panel>
</mat-accordion>
</div>


  <!-- Main content area -->
  <div class="app-container">

    <!-- Left side: split into top and bottom halves -->
    <div class="left-side">

      <!-- Top Sigma container -->
      <div class="half-container sigma-top">
        <div class="loading-overlay" *ngIf="isTopLoading">
          <div class="spinner"></div>
          <p>Loading Visualisation...</p>
        </div>
        <div id="sigma-top-container" #sigmaContainerTop></div>
      </div>

      <!-- Bottom Sigma container -->
      <div class="half-container sigma-bottom">
        <div class="loading-overlay" *ngIf="isBottomLoading">
          <div class="spinner"></div>
          <p>Loading Visualisation...</p>
        </div>
        <div class="overlay" *ngIf="showBottomOverlay">
          <div class="overlay-content">
            Please select a clone to view...
          </div>
        </div>
        <div id="sigma-bottom-container" #sigmaContainerBottom></div>
      </div>

    </div>

    <!-- Right side panel -->
    <aside class="side-panel">

      <!-- Controls section -->
      <div class="top-fixed">
        <h2>Controls</h2>
        <button (click)="zoomIn()">Zoom In</button>
        <button (click)="zoomOut()">Zoom Out</button>
        <button (click)="resetZoom()">Reset</button>
        </div>
        <div class = pedigree>
        <h2>Pedigree Layout</h2>
        <h3>Filtered:</h3>
              <label>
                <input
                  type="radio"
                  name="isfiltered"
                  value= no
                  [(ngModel)]="isfiltered"
                />
                No
              </label>
              <label>
                <input
                  type="radio"
                  name="isfiltered"
                  value= yes
                  [(ngModel)]="isfiltered"
                />
                Yes
              </label>
        <h3>Layer by:</h3>
              <label>
                <input
                  type="radio"
                  name="selectedLayer"
                  value='year'
                  [(ngModel)]="selectedLayer"
                />
                Year
              </label>
              <label>
                <input
                  type="radio"
                  name="selectedLayer"
                  value='generation'
                  [(ngModel)]="selectedLayer"
                />
                Generation
              </label>
        <h3>Group by:</h3>
              <label>
                <input
                  type="radio"
                  name="selectedGroup"
                  value='sibling'
                  [(ngModel)]="selectedGroup"
                />
                Siblings
              </label>
              <label>
                <input
                  type="radio"
                  name="selectedGroup"
                  value='none'
                  [(ngModel)]="selectedGroup"
                />
                None
              </label>

        <h3>Colour:</h3>
              <label>
                <input
                  type="radio"
                  name="selectedColour"
                  value='year'
                  [(ngModel)]="selectedColour"
                />
                Year
              </label>
              <label>
                <input
                  type="radio"
                  name="selectedColour"
                  value='generation'
                  [(ngModel)]="selectedColour"
                />
                Generation
              </label>
        <h3>Node Size:</h3>
              <label>
                <input
                  type="radio"
                  name="scale"
                  [value]="true"
                  [(ngModel)]="scale"
                />
                No. of Descendants
              </label>
              <label>
                <input
                  type="radio"
                  name="scale"
                  [value]="false"
                  [(ngModel)]="scale"
                />
                None 
              </label>


      <button (click)="updateDiagram()">Update</button>
      </div>
      <div class="side-scrollable">

      <div class='my-legend' *ngIf="legend.length > 0">
        <h2>Legend</h2>
        <p>{{selectedColour}}</p>
        <div class='legend-scale'>
          <ul class='legend-labels'>
            <li *ngFor="let item of legend">
              <span [ngStyle]="{'background': item.colour}"></span>
              {{ item.element }}
            </li>
          </ul>
        </div>
      </div>
      <div class="search-panel">
          <!-- Search Input -->
           <h2>Search</h2>
           <p>Enter an individual ID:</p>
          <input
            type="text"
            placeholder="Search..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            class="search-input"
          />

          <!-- Dropdown of matching items -->
          <ul class="dropdown" *ngIf="filteredData.length < 20">
            <li *ngFor="let item of filteredData" (click)="selectItem(item)">{{ item }} 
            </li>
          </ul>
        </div>
              <!-- Stats section -->
      <div class="bottom-half">
        <h3>Statistics</h3>
        <p>Nodes: {{ stats.nodes }}</p>
        <p>Edges: {{ stats.edges }}</p>
      </div>
      </div>



    </aside>

  </div>

</div>

