<!-- Top-level container -->
<div class="app-wrapper">
<div class="title-wrapper">
    <h1>Pedigree Visualisation</h1>
  <mat-accordion class="help-bar">
  <mat-expansion-panel class="custom-help-panel">
    <mat-expansion-panel-header>
      <mat-panel-title>
        Help
      </mat-panel-title>
    </mat-expansion-panel-header>
        <p>This visualisation tool has been developed to all easy exploration of the pedigree data uploaded to TeaPP. A default graph is displayed in the top container ready for interaction and seelction of individual nodes.
      Specific graph layout options can be selected in the right-handside panel, which will render a new visualisation when "update" is selected.
    </p>
    <p>Selection of individual plants will display its pedigree family (closest relatives) in the bottom containe, highlighting the respective individuals in the original graph above.</p>
    <p style="color: red;">
        <mat-icon>error</mat-icon>
        If the visualisation fails to load or is blank, please check the status of the Neoj4 Database in the "Admin Tools" tab located on the Home-Page. If "Offline" please restart the database connection and return to the visulisation page.
    </p>
  </mat-expansion-panel>
</mat-accordion>
</div>


  <!-- Main content area -->
  <div class="app-container">
  <aside class="left-side-panel">

    <div class='my-legend' *ngIf="legend.length > 0">
        <h3>Legend</h3>
        <p>{{legendText}}</p>
        <div class='legend-scale'>
          <ul class='legend-labels'>
            <li *ngFor="let item of legend">
              <span [ngStyle]="{'background': item.colour}"></span>
              {{ item.element }}
            </li>
          </ul>
        </div>
    </div>
  </aside>

    <!-- Left side: split into top and bottom halves -->
    <div class="left-side">

      <!-- Top Sigma container -->
      <div class="half-container sigma-top">
        <div class="loading-overlay" *ngIf="isTopLoading">
          <div class="spinner"></div>
          <p>Loading Visualisation...</p>
        </div>
        <div id="sigma-top-container" #sigmaContainerTop></div>
      </div>

      <!-- Bottom Sigma container -->
      <div class="half-container sigma-bottom">
        <div class="loading-overlay" *ngIf="isBottomLoading">
          <div class="spinner"></div>
          <p>Loading Visualisation...</p>
        </div>
        <div class="overlay" *ngIf="showBottomOverlay">
          <div class="overlay-content">
            Please select a clone to view...
          </div>
        </div>
        <div id="sigma-bottom-container" #sigmaContainerBottom></div>
      </div>

    </div>
    
    <!-- Right side panel -->
    <aside class="side-panel">

      <!-- Controls section -->
      <div class="top-fixed">
        <h3>Controls</h3>
        <button (click)="zoomIn()">Zoom In</button>
        <button (click)="zoomOut()">Zoom Out</button>
        <button (click)="resetZoom()">Reset</button>
        </div>
        <div class = pedigree>
        <h3>Pedigree Layout</h3>
        <h4>Filtered:</h4>
              <label>
                <input
                  type="radio"
                  name="isfiltered"
                  value= no
                  [(ngModel)]="isfiltered"
                />
                No
              </label>
              <label>
                <input
                  type="radio"
                  name="isfiltered"
                  value= yes
                  [(ngModel)]="isfiltered"
                />
                Yes
              </label>
        <h4>Layer by:</h4>
              <label>
                <input
                  type="radio"
                  name="selectedLayer"
                  value='year'
                  [(ngModel)]="selectedLayer"
                />
                Year
              </label>
              <label>
                <input
                  type="radio"
                  name="selectedLayer"
                  value='generation'
                  [(ngModel)]="selectedLayer"
                />
                Generation
              </label>
        <h4>Group by:</h4>
              <label>
                <input
                  type="radio"
                  name="selectedGroup"
                  value='sibling'
                  [(ngModel)]="selectedGroup"
                />
                Siblings
              </label>
              <label>
                <input
                  type="radio"
                  name="selectedGroup"
                  value='none'
                  [(ngModel)]="selectedGroup"
                />
                None
              </label>

        <h4>Colour:</h4>
              <label>
                <input
                  type="radio"
                  name="selectedColour"
                  value='year'
                  [(ngModel)]="selectedColour"
                />
                Year
              </label>
              <label>
                <input
                  type="radio"
                  name="selectedColour"
                  value='generation'
                  [(ngModel)]="selectedColour"
                />
                Generation
              </label>
        <h4>Node Size:</h4>
              <label>
                <input
                  type="radio"
                  name="scale"
                  [value]="true"
                  [(ngModel)]="scale"
                />
                No. of Descendants
              </label>
              <label>
                <input
                  type="radio"
                  name="scale"
                  [value]="false"
                  [(ngModel)]="scale"
                />
                None 
              </label>


      <button (click)="updateDiagram()">Update</button>
      </div>
      <div class="side-scrollable">

      <div class="search-panel">
          <!-- Search Input -->
           <h3>Search</h3>
           <p>Enter an individual ID:</p>
          <input
            type="text"
            placeholder="Search..."
            [(ngModel)]="searchTerm"
            (input)="onSearch()"
            class="search-input"
          />

          <!-- Dropdown of matching items -->
          <ul class="dropdown" *ngIf="filteredData.length < 20">
            <li *ngFor="let item of filteredData" (click)="selectItem(item)">{{ item }} 
            </li>
          </ul>
        </div>
              <!-- Stats section -->
      <div class="bottom-half">
        <h3>Statistics</h3>
        <p>Nodes: {{ stats.nodes }}</p>
        <p>Edges: {{ stats.edges }}</p>
      </div>
      </div>



    </aside>

  </div>

</div>

